# Cupcake Trading System (Prototype)

> **⚠️ CRITICAL WARNING: EDUCATIONAL USE ONLY**
>
> **DO NOT USE THIS SOFTWARE FOR REAL MONEY TRADING.**
>
> This project is an **experimental prototype** designed strictly for **educational and research purposes**. It is **NOT** a production-ready trading system.
>
> *   **No Financial Advice:** The algorithms and signals generated by this system are based on theoretical models and should not be interpreted as financial advice.
> *   **High Risk:** Automated trading systems carry significant risks, including software bugs, latency issues, and API failures, which can result in substantial financial loss.
> *   **Liability:** The authors and contributors assume **NO RESPONSIBILITY** for any financial losses, damages, or legal consequences arising from the use or misuse of this code.
> *   **Security:** This software is not hardened for security. It is intended to run in a controlled, isolated environment.

---

## 1. System Overview

**Cupcake** is a Python-based algorithmic trading framework designed to interface with the Upstox API. It implements a microservices-like architecture (monolithically orchestrated) to handle real-time market data ingestion, quantitative analysis, and signal generation.

The system is engineered to demonstrate:
*   **High-Frequency Data Ingestion:** Consuming WebSocket feeds via Protocol Buffers.
*   **In-Memory Time-Series Management:** Utilizing Redis for low-latency data access.
*   **Quantitative Modeling:** implementing technical indicators and statistical arbitrage models using NumPy and Pandas.
*   **Asynchronous I/O:** leveraging `asyncio` and `aiohttp` for non-blocking operations.

## 2. Technical Stack

### Core Infrastructure
*   **Language:** Python 3.10+
*   **Containerization:** Docker & Docker Compose
*   **Database:** Redis 7.x (used for Pub/Sub, Caching, and transient Time-Series storage)

### Application Layer
*   **Web Framework:** Flask (Backend), Flask-SocketIO (Real-time client communication)
*   **Server:** Gunicorn (WSGI HTTP Server)
*   **Frontend:** HTML5, Tailwind CSS, Socket.IO Client

### Data Science & Quantitative Libraries
*   **NumPy & Pandas:** High-performance numerical computation and dataframe manipulation.
*   **SciPy:** Scientific computing and optimization algorithms.
*   **Scikit-learn:** Predictive modeling and regression analysis.
*   **TA-Lib:** Technical Analysis Library for standard market indicators (RSI, MACD, Bollinger Bands).

### Networking & API
*   **Upstox API:** REST API for orders/history, WebSocket API for live feeds.
*   **Protobuf:** Efficient serialization for market data feeds.
*   **Asyncio/Aiohttp:** Asynchronous HTTP requests and concurrency management.

## 3. Architecture Components

The system is modularized into several key components:

1.  **`main.py` (Orchestrator):** Initializes the Flask application, establishes SocketIO namespaces, and spawns background daemon threads for data fetchers.
2.  **`enhanced_live_fetcher.py`:** A dedicated WebSocket client that connects to the Upstox market feed. It decodes binary Protobuf messages and pushes normalized data to Redis.
3.  **`enhanced_signal_generator.py`:** Subscribes to the live data stream. It applies quantitative models to generate actionable buy/sell signals based on configured strategies.
4.  **`historical_data_fetcher.py`:** A utility to backfill historical candle data into Redis, essential for initializing indicators and backtesting.
5.  **`portfolio_tracker.py`:** Monitors active positions, calculates real-time P&L, and manages risk exposure.

## 4. Installation & Configuration

### Prerequisites
*   **Docker Engine** and **Docker Compose**
*   **Upstox API Credentials** (API Key, API Secret, Redirect URI)

### Configuration Setup
The system requires two configuration files in the root directory.

1.  **`credentials.json`** - Contains sensitive API keys.
    ```json
    {
        "api_key": "YOUR_API_KEY",
        "api_secret": "YOUR_API_SECRET",
        "redirect_uri": "https://your-redirect-uri.com",
        "access_token": "OPTIONAL_MANUAL_TOKEN"
    }
    ```
    *Security Note: This file is excluded from git via `.gitignore`. Do not commit it.*

2.  **`symbols.json`** - Defines the instrument universe.
    ```json
    {
        "symbols": [
            {
                "name": "RELIANCE", 
                "instrument_key": "NSE_EQ|INE002A01018", 
                "exchange": "NSE"
            }
        ]
    }
    ```

### Deployment

**Option A: Docker (Production-like Environment)**
This is the recommended method as it isolates the Redis dependency and ensures environment consistency.

```bash
# Build the container image
docker-compose build

# Start the application and Redis services
docker-compose up -d

# Tail the logs
docker-compose logs -f
```
The application will be accessible at `http://localhost:5000`.

**Option B: Local Development**
Requires a local Redis instance running on port 6379.

```bash
# Create and activate a virtual environment
python -m venv venv
source venv/bin/activate  # or venv\Scripts\activate on Windows

# Install dependencies
pip install -r requirements.txt

# Run the system
python main.py
```

## 5. Operational Modes

The `main.py` entry point supports varying operational modes via CLI arguments:

*   `--mode full` (Default): Runs the web server, live data feed, and signal engine.
*   `--mode backfill`: Executes the historical data downloader and exits.
*   `--mode viewer`: Launches a CLI-based inspection tool for Redis data.
*   `--skip-auth`: Bypasses the Upstox authentication flow (development only).

## 6. License

This project is open-source and available under the MIT License. See the LICENSE file for details.

---

**Maintainer Note:** This repository is maintained for archival and educational reference. Code quality, test coverage, and documentation may vary.
